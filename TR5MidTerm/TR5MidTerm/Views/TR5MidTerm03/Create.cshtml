 
@model TR5MidTerm.Models.TR5MidTermViewModels.商品檔CreateViewModel

<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()

    <div class="row">
        <!-- 錯誤訊息 -->
        <div class="col-md-12">
            <div id="ModelErrorDiv" class="validation-summary-valid text-danger">
                <ul></ul>
            </div>
        </div>

        <!-- 商品編號 -->
        <div class="col-md-6">
            <div class="form-group">
                <label asp-for="商品編號" class="control-label"></label>
                <input asp-for="商品編號" class="form-control" placeholder="請輸入商品編號" />
                <span asp-validation-for="商品編號" class="text-danger"></span>
            </div>
        </div>

        <!-- 商品名稱 -->
        <div class="col-md-6">
            <div class="form-group">
                <label asp-for="商品名稱" class="control-label"></label>
                <input asp-for="商品名稱" class="form-control" placeholder="請輸入商品名稱" />
                <span asp-validation-for="商品名稱" class="text-danger"></span>
            </div>
        </div>

        <!-- 商品類別 -->
        <div class="col-md-6">
            <div class="form-group">
                <label asp-for="商品類別編號" class="control-label"></label>
                <select asp-for="商品類別編號" asp-items="ViewBag.商品類別選項" class="form-control">
                    <option value="" disabled selected>-- 請選擇商品類別 --</option>
                </select>
                <span asp-validation-for="商品類別編號" class="text-danger"></span>
            </div>
        </div>



        <!-- 單價 -->
        <div class="col-md-6">
            <div class="form-group">
                <label asp-for="單價" class="control-label"></label>
                <input asp-for="單價" class="form-control" placeholder="請輸入單價" />
                <span asp-validation-for="單價" class="text-danger"></span>
            </div>
        </div>

        <!-- 物件編號 -->
        <div class="col-md-6">
            <div class="form-group">
                <label asp-for="物件編號" class="control-label"></label>
                <input asp-for="物件編號" class="form-control" id="物件編號欄位" placeholder="請輸入物件編號" />
                <span asp-validation-for="物件編號" class="text-danger"></span>
            </div>
        </div>

        <!-- 建物/住宅選擇區 -->
        <div class="col-md-6" id="建物資料選擇區" style="display:none;">
            <label class="control-label">請選擇建物或租賃住宅資料</label>

            <!-- 建物清單 -->
            <select class="form-control mt-1" id="建物清單選單" style="display:none;">
                @if ((ViewBag.建物資料清單 as List<SelectListItem>)?.Any() == true)
                {
                    <option value="">請選擇建物</option>
                    @foreach (var item in ViewBag.建物資料清單 as List<SelectListItem>)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                }
                else
                {
                    <option disabled selected>⚠️ 您的組織沒有建物項目</option>
                }
            </select>

            <!-- 租賃住宅清單 -->
            <select class="form-control mt-2" id="住宅清單選單" style="display:none;">
                @if ((ViewBag.租賃住宅資料清單 as List<SelectListItem>)?.Any() == true)
                {
                    <option value="">請選擇住宅</option>
                    @foreach (var item in ViewBag.租賃住宅資料清單 as List<SelectListItem>)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                }
                else
                {
                    <option disabled selected>⚠️ 您的組織沒有住宅項目</option>
                }
            </select>
        </div>

        <!-- 隱藏主鍵 -->
        @Html.HiddenFor(m => m.事業)
        @Html.HiddenFor(m => m.單位)
        @Html.HiddenFor(m => m.部門)
        @Html.HiddenFor(m => m.分部)

        <!-- 按鈕區 -->
        <div class="col-md-12 text-end mt-3">
            <button type="submit" class="btn btn-primary">儲存</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        </div>
    </div>
</form>


<script>
    $(document).ready(function () {
        const $類別選單 = $('[name="商品類別編號"]');
        const $建物資料區 = $('#建物資料選擇區');
        const $建物清單 = $('#建物清單選單');
        const $住宅清單 = $('#住宅清單選單');
        const $物件欄位 = $('#物件編號欄位');

        function 控制欄位狀態() {
            const code = $類別選單.val();

            if (code === '01') {
                // 顯示建物選單
                $建物資料區.show();
                $建物清單.show();
                $住宅清單.hide();
                $物件欄位.prop('readonly', true).val('');
            }
            else if (code === '34') {
                // 顯示住宅選單
                $建物資料區.show();
                $建物清單.hide();
                $住宅清單.show();
                $物件欄位.prop('readonly', true).val('');
            }
            else {
                // 隱藏全部
                $建物資料區.hide();
                $建物清單.hide();
                $住宅清單.hide();
                $物件欄位.prop('readonly', false).val('');
            }
        }

        // 下拉變更時將值填回物件欄位
        $建物清單.change(function () {
            $物件欄位.val($(this).val());
        });

        $住宅清單.change(function () {
            $物件欄位.val($(this).val());
        });

        $類別選單.change(function () {
            控制欄位狀態();
        });

        控制欄位狀態(); // 頁面初始化時執行一次
    });
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
