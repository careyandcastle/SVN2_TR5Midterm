@using TR5MidTerm.Models.TR5MidTermViewModels
@model 水電總表檔EditViewModel

<div>
    <div class="row">
        <div class="col">
            <form asp-action="Edit">
                <div id="ModelErrorDiv" class="validation-summary-valid text-danger">
                    <ul></ul>
                </div>

                @* 主鍵欄位，隱藏傳值用 *@
                <input asp-for="事業" type="hidden" />
                <input asp-for="單位" type="hidden" />
                <input asp-for="部門" type="hidden" />
                <input asp-for="分部" type="hidden" />
                <input asp-for="總表號" type="hidden" />

                <div class="form-group">
                    <label asp-for="案號" class="control-label"></label>
                    <input asp-for="案號" class="form-control" />
                    <span asp-validation-for="案號" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="計量表種類編號" class="control-label"></label>
                    <select asp-for="計量表種類編號" class="form-control" asp-items="ViewBag.計量表種類選項"></select>
                    <span asp-validation-for="計量表種類編號" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="計量對象" class="control-label"></label>
                    <input asp-for="計量對象" class="form-control" />
                    <span asp-validation-for="計量對象" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="計量表種類" class="control-label"></label>
                    <input asp-for="計量表種類" class="form-control" readonly />
                    <span asp-validation-for="計量表種類" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <input type="submit" value="送出" class="btn btn-primary" />
                </div>
            </form>
        </div>
    </div>
</div>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script>
    $(document).ready(function () {

        //#region function:租賃用途選擇
        console.log("[頁面載入] 初始化租賃用途切換邏輯");

        const $selectDiv = $('#租賃用途-select-div');
        const $inputDiv = $('#租賃用途-input-div');
        const $select = $selectDiv.find('select');
        const $input = $inputDiv.find('input');
        const $modeRadios = $('input[name="inputMode"]');

        function 切換輸入方式() {
            const selectedMode = $modeRadios.filter(':checked').val();

            if (selectedMode === 'select') {
                $selectDiv.show();
                $select.prop('disabled', false);      // ✅ 使能送出
                $inputDiv.hide();
                $input.prop('disabled', true);        // ❌ 避免參與表單送出
                $input.val('');
            } else {
                $selectDiv.hide();
                $select.prop('disabled', true);
                $select.val('');

                $inputDiv.show();
                $input.prop('disabled', false);
            }
        }
        //#endregion
        //#region function:計算終止日期(當起始日期或租期月數變動時)
        function 計算終止日期() {
            const startDate = $('#租約起始日期').val();
            const months = parseInt($('#租期月數').val());

            if (!startDate || isNaN(months)) {
                $('#租約終止日期').val('');
                return;
            }

            const date = new Date(startDate);
            date.setMonth(date.getMonth() + months);

            // 將 date 轉換為 yyyy/MM/dd 格式
            const y = date.getFullYear();
            const m = (date.getMonth() + 1).toString().padStart(2, '0');
            const d = date.getDate().toString().padStart(2, '0');
            $('#租約終止日期').val(`${y}/${m}/${d}`);
        }
        //#endregion


        $modeRadios.change(function () {
            切換輸入方式();
        });
        // 綁定事件
        $('#租約起始日期, #租期月數').on('change keyup', function () {
            計算終止日期();
        });
        // 初始執行
        切換輸入方式();
        計算終止日期();
        //#endregion
    });
</script>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

